%tbody.expense-group
  %tr.nested-fields
    %td
      = f.collection_select :expense_type_id, ExpenseType.all, :id, :name, {prompt: true}, {class: 'select2'}
      = validation_error_message(f.object, :expense_type_id)
    %td
      = f.text_field :location
      = validation_error_message(f.object, :location)
    %td
      = f.number_field :quantity, class: 'quantity', min: 0
      = validation_error_message(f.object, :quantity)
    %td
      = f.number_field :rate, value: number_with_precision(f.object.rate, precision: 2), class: 'rate'
      = validation_error_message(f.object, :rate)
    %td.amount
      = number_to_currency(f.object.amount)
    %td.add-expense-date-attended
      = link_to_add_association t('.add_date_attended'), f, :dates_attended, class: 'button-secondary', data: {'association-insertion-method' => 'after', 'association-insertion-traversal' => 'closest', 'association-insertion-node' => 'tr'}
    %td.remove-expense
      = link_to_remove_association t('.remove'), f, { wrapper_class: 'expense-group' }

  = f.fields_for :dates_attended do |date_attended|
    = render 'date_attended_fields', f: date_attended
