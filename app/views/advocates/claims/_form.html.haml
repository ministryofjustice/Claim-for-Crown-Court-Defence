= form_for [:advocates, @claim] do |f|
  - if @claim.errors.any?
    %h2= "#{pluralize(@claim.errors.count, 'error')} prohibited this claim from being saved:"
    %ul
      - @claim.errors.full_messages.each do |msg|
        %li= msg

  %fieldset
    %legend
      Section 1: Case, Instructed Advocate & Offence

    = f.label :scheme
    %br
    = f.collection_select :scheme_id, Scheme.all, :id, :name, prompt: true
    %br
    = f.label :case_type
    %br
    = f.collection_select :case_type, Claim::CASE_TYPES, :to_s, :humanize, prompt: true
    %br
    = f.label :prosecuting_authority
    %br
    = f.collection_select :prosecuting_authority, Claim::PROSECUTING_AUTHORITIES, :to_s, :upcase, prompt: true
    %br
    = f.label :indictment_number
    %br
    = f.text_field :indictment_number
    %br
    = f.label :court
    %br
    = f.collection_select :court_id, Court.all, :id, :name, prompt: true
    %br
    = f.label :case_number
    %br
    = f.text_field :case_number
    %br
    = f.label :advocate_category
    %br
    = f.collection_select :advocate_category, Claim::ADVOCATE_CATEGORIES, :to_s, :humanize, prompt: true
    %br
    = f.label :offence
    %br
    = f.grouped_collection_select :offence_id, OffenceClass.includes(:offences), :offences, :description, :id, :description, prompt: true

    %p Defendants
    #defendants
      = f.fields_for :defendants do |defendant|
        = render 'defendant_fields', f: defendant
        .links
          = link_to_add_association 'Add Defendant', f, :defendants, class: 'button'

  %br
  %fieldset
    %legend
      Section 2: Additional Information
    = f.text_area :additional_information, rows: 10, style: 'width: 100%'

  %fieldset
    %legend
      Fees
    #fees
      = f.fields_for :fees do |fee|
        = render 'fee_fields', f: fee
        .links
          = link_to_add_association 'Add Fee', f, :fees, class: 'button'
  %br

  %fieldset
    %legend
      Expenses
    #expenses
      = f.fields_for :expenses do |expense|
        = render 'expense_fields', f: expense
        .links
          = link_to_add_association 'Add Expense', f, :expenses, class: 'button'
  %br

  = f.label :apply_vat, 'VAT on Fees & Expenses (please tick if required)'
  = f.check_box :apply_vat

  %br
  %br

  %fieldset
    %legend
      Supporting evidence documents
    #documents
      = f.fields_for :documents do |document|
        = render 'document_fields', f: document
        .links
          = link_to_add_association 'Add Document', f, :documents, class: 'button'
  %br

  %p
    = f.submit 'Submit', class: 'button'
