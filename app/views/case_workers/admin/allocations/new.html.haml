%h1
  Claim allocation

%p
  = form_tag case_workers_admin_allocations_path, method: :get do
    = label_tag do
      = radio_button_tag :filter, 'all', params[:filter].blank? || params[:filter] == 'all'
      All

    != "&nbsp";

    = label_tag do
      = radio_button_tag :filter, 'fixed_fee', params[:filter] == 'fixed_fee'
      Fixed fee

    != "&nbsp";

    = label_tag do
      = radio_button_tag :filter, 'cracked', params[:filter] == 'cracked'
      Cracked

    != "&nbsp";

    = label_tag do
      = radio_button_tag :filter, 'trial', params[:filter] == 'trial'
      Trial

    != "&nbsp";

    = label_tag do
      = radio_button_tag :filter, 'guilty_plea', params[:filter] == 'guilty_plea'
      Guilty plea

    != "&nbsp";

    = submit_tag 'Filter'

    != "&nbsp";

    = pluralize(@claims.count, 'claim')

- if @allocated_claims
  = render 'allocated_summary'

= form_for [:case_workers, :admin, @allocation] do |f|
  - if @allocation.errors.any?
    .validation-summary
      %h2.heading-small
        = "#{pluralize(@allocation.errors.count, 'error')}"
        prohibited save
      %ul
        - @allocation.errors.full_messages.each do |msg|
          %li= msg

  %p
    = f.grouped_collection_select :case_worker_id, Location.all, :case_workers, :name, :id, :name, { prompt: 'Select case worker' }, { class: 'select2', style: 'display: inline-block; width: 200px;' }

    = number_field_tag :quantity_to_allocate, nil, placeholder: 'Number to allocate'

    = hidden_field_tag 'filter', params[:filter]

    = f.submit 'Allocate', class: 'button'

  %table
    %thead
      %th
        = link_to 'Select all', '#', class: 'select-all'
      %th
        Case number
      %th
        Advocate
      %th
        Type
      %th
        Submission date
      %th
        Value
    %tbody
      = f.collection_check_boxes :claim_ids, @claims, :id, :case_number do |b|
        %tr{id: dom_id(b.object)}
          %td
            = b.check_box
          %td
            = b.label do
              = b.object.case_number
          %td
            = b.label do
              = b.object.advocate.name
          %td
            = b.label do
              = b.object.case_type
          %td
            = b.label do
              = b.object.submitted_at.strftime(Settings.date_format)
          %td
            = b.label do
              = number_to_currency(b.object.total)

