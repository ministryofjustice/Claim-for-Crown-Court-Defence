%h2.bold-medium
  = t('.case_advocate_offence')

%fieldset

  - if advocate_claim?
    %legend.xsmall
      = f.anchored_without_label t('.advocate_category')
      = t('.advocate_category')
    .form-group.inline
      = f.collection_radio_buttons(:advocate_category, Settings.advocate_categories.sort, :to_s, :to_s) do |b|
        - b.label(class: "block-label") { b.radio_button + b.value.to_s }
      = validation_error_message(@error_presenter, :advocate_category)

    .form-group
      .column-half
        - if current_user.persona.admin?
          = f.anchored_label t('.advocate'), 'external_user'
          = f.collection_select :external_user_id, @advocates_in_provider, :id, :name_and_number, {prompt: true}, {class: 'select2'}
          = validation_error_message(@error_presenter, :external_user)

.form-group
  .column-half
    = f.anchored_label t('.court')
    = f.collection_select :court_id, Court.all, :id, :name, { prompt: true }, { class: 'select2' }
    = validation_error_message(@error_presenter, :court)

.grid-row
  .column-half
    = f.anchored_label t('.case_type')
    .form-hint.xsmall.zero-vert-margin
      &nbsp;
    = f.collection_select2_with_data :case_type_id, @case_types, :id, :name, {'is-fixed-fee' => :is_fixed_fee?}, { prompt: true }
    = validation_error_message(@error_presenter, :case_type)

  .column-half
    = f.anchored_label t('.case_number')
    .form-hint.xsmall.zero-vert-margin
      = "eg A12345678"
    = f.text_field :case_number
    = validation_error_message(@error_presenter, :case_number)

= render partial: 'external_users/claims/case_details/cracked_trial_fields', locals: { f: f }

.indent-fieldset#trial-details
  = render partial: 'external_users/claims/case_details/trial_detail_fields', locals: { f: f }
.indent-fieldset#retrial-details
  = render partial: 'external_users/claims/case_details/retrial_detail_fields', locals: { f: f }

.grid-row#offence
  .column-half
    = f.anchored_label t('.offence_category')
    .form-hint.xsmall.zero-vert-margin
      = "If the offence category is not listed, choose \"Miscellaneous/other\""
    - if @claim.new_record?
      - selected_offence_category = params[:offence_category].present? ? params[:offence_category][:description] : nil
    - else
      - selected_offence_category = @claim.offence.description rescue nil
    = collection_select :offence_category, :description, @offence_descriptions, :description, :description, { prompt: t('.select_category'), selected: selected_offence_category }, { class: 'select2' }
    = validation_error_message(@error_presenter, :offence)

  .column-half
    .offence-class-select
      = render partial: 'external_users/claims/case_details/offence_select', locals: { offences: @offences }

    = f.hidden_field :offence_id, value: f.object.offence ? f.object.offence.id : nil
