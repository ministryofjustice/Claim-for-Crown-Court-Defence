-fee = present(f.object)
.form-group.fixed-fee-group.nested-fields.js-block{data:{type:"fees", autovat: @claim.apply_vat? ? "true" : "false", "block-type": "FeeBlockCalculator"}}
  .grid-row
    .column-one-half.fee-type
      %label.form-label
        = t('.fee_type')
      %a{name: "fixed_fee_#{@fixed_fee_count}_fee_type"}
        = f.collection_select :fee_type_id, @claim.eligible_fixed_fee_types, :id, :description, {include_blank: true}, {class: 'form-control autocomplete', style: 'width:400px'}
        = validation_error_message(@error_presenter, "fixed_fee_#{@fixed_fee_count}_fee_type")

    .column-one-quarter.fee-quantity
      %label.form-label
        = t('.quantity')
      %a{name: "fixed_fee_#{@fixed_fee_count}_quantity"}
        = f.number_field :quantity, value: fee.quantity, min: 0, max: 99999, maxlength: 5, class: 'form-control quantity'
        = validation_error_message(@error_presenter, "fixed_fee_#{@fixed_fee_count}_quantity")

    .column-one-quarter.fee-rate
      %label.form-label
        = t('.rate')
      %a{name: "fixed_fee_#{@fixed_fee_count}_rate"}
      %span.currency-indicator>< &pound;
      = f.number_field :rate, min: 0, max: 99999, value: fee.rate_as_float, class: 'form-control rate', size: 10
      = validation_error_message(@error_presenter, "fixed_fee_#{@fixed_fee_count}_rate")

  .grid-row
    .column-one-third.fee-total
      %label.form-label Total
      %span.total{data: {'total': fee.amount ||= 0}}
        = fee.amount ||= 0

  .grid-row.fee-dates-row

    %label.form-label Dates

    %span.no-dates.form-hint
      = t('.no_dates')
    = link_to_add_association t('.add_date_attended'), f, :dates_attended, class: '', data: {'association-insertion-method' => 'prepend','association-insertion-traversal' => 'next', 'association-insertion-node' => 'div'}

    .grid-row.dates-wrapper
      = f.fields_for :dates_attended do |date_attended|
        = render 'date_attended_fields', f: date_attended, submodel_count: date_attended.index+1, parent_model_prefix: "fixed_fee_#{@fixed_fee_count}"

  = link_to_remove_association t('.remove'), f, { wrapper_class: 'fixed-fee-group' }