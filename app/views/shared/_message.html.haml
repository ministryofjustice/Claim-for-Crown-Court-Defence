- if history_item.is_a? Message
  - message = history_item
  .grid-row{id: dom_id(message) }

    - if message.sender.persona.is_a?(Advocate)
      .column-two-thirds
        .message-left
          .message-container
            .message-body
              = message.body
              - if message.attachment.present?
                .has-attachment
                  = "Attachment:"
                  = link_to(message.attachment.original_filename, download_attachment_message_path(message), title: 'Download '+ message.attachment.original_filename, class: 'attachment')
            .grid-row.message-audit
              .column-half.sender
                = message.sender.name
                (#{message.sender.persona.class.to_s.humanize})
              .column-half.sent
                = message.created_at
      .column-third
        &nbsp;

    - if message.sender.persona.is_a?(CaseWorker)
      .column-third
        &nbsp;
      .column-two-thirds
        .message-right
          .message-container
            .message-body
              = message.body
              - if message.attachment.present?
                .has-attachment
                  = "Attachment:"
                  = link_to(message.attachment.original_filename, download_attachment_message_path(message), title: 'Download '+ message.attachment.original_filename, class: 'attachment')
            .grid-row.message-audit
              .column-half.sender
                - if current_user.persona.is_a?(CaseWorker)
                  = message.sender.name
                (#{message.sender.persona.class.to_s.humanize})
              .column-half.sent
                = message.created_at

- elsif history_item.is_a?(PaperTrail::Version) && history_item.item_type == 'Determination'
  - present(history_item, DeterminationPresenter) do |determination|
    .grid-row.history
      .column-two-thirds
        &nbsp;
      .column-third
        .event
          %strong
            = determination.event
          = determination.timestamp
          %table
            - determination.itemise do |item, amount|
              %tr
                %td
                  #{item.humanize}:
                %td
                  #{number_to_currency(amount)}

- elsif history_item.is_a?(PaperTrail::Version) && history_item.event == 'State change'
  - present(history_item, StateChangePresenter) do |state_change|
    .grid-row.history
      .column-quarter
        &nbsp;
      .column-three-quarter
        .event
          %strong
            = state_change.change
          = state_change.timestamp
