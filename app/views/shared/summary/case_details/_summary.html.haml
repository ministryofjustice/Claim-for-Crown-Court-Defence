- claim_fields = %i[external_users claims case_details fields]
- cracked_trial_fields = %i[external_users claims case_details cracked_trial_fields]
- trial_detail_fields = %i[external_users claims case_details trial_detail_fields]
- retrial_detail_fields = %i[external_users claims case_details retrial_detail_fields]
#case-details-section.form-section
  %h3.heading-medium
    = t('.header')
    - if local_assigns[:editable]
      = link_to t('.change'), edit_polymorphic_path(claim, step: :case_details, referrer: :summary), class: 'link-change', 'aria-label': t('.change_link_label')

  - if claim.mandatory_case_details?
    %table.summary{ summary: t('.summary') }
      %caption
        %span.table-caption.visuallyhidden
          = "This section contains details of the case"
      %tbody
        - unless claim.providers_ref.blank?
          %tr
            %th{scope: "col"}
              = 'Provider reference number'
            %td
              = claim.providers_ref

        - unless claim.draft?
          %tr
            %th{scope: "col"}
              = "Claim submitted on"
            %td
              = claim.submitted_at

        - if claim.case_workers.any? && current_user_is_caseworker? && current_user.persona.admin?
          %tr
            %th{scope: "col"}
              = t ('.assignee')
            %td
              = claim.case_worker_names

        - if @claim.lgfs?
          %tr
            %th{scope: "col"}
              = t('common.external_user.claim_creator')
            %td
              = claim.creator.name

        - if @claim.agfs?
          %tr
            %th{scope: "col"}
              = t("common.external_user.#{@claim.external_user_type}")
            %td
              = claim.external_user.name
          %tr
            %th{scope: "col"}
              = t("common.external_user.category.#{@claim.external_user_type}")
            %td
              = claim.advocate_category

        %tr
          %th{scope: "col"}
            = t("common.external_user.account_number.#{@claim.external_user_type}")
          %td
            = claim.supplier_number

        %tr
          %th{scope: "col"}
            = t('common.crown_court')
          %td
            = claim.court.name if claim.court

        %tr
          %th{scope: "col"}
            =t('.case_num')
          %td
            = claim.case_number
            - if current_user_is_caseworker?
              %span.unique-id-small
                = claim.unique_id

        - if claim.transfer_court.present?
          %tr
            %th{scope: "col"}
              = t('common.transfer_court')
            %td
              = claim.transfer_court.name

          %tr
            %th{scope: "col"}
              = t('common.transfer_case_number')
            %td
              = claim.transfer_case_number

        - if claim.case_type.try(:name)
          %tr
            %th{scope: "col"}
              = t('.case_type')
            %td
              = claim.case_type.try(:name)

        - if claim.agfs? && claim.case_type.present? && claim.requires_cracked_dates?
          = render partial: 'shared/claim_cracked_trial_details', locals: { claim: claim }

        - if claim.case_type && claim.case_concluded_at
          = render partial: 'shared/claim_case_concluded_at_details', locals: { claim: claim }

        - if claim.lgfs? && claim.interim? && !claim.interim_fee.nil?
          = render partial: 'shared/claim_interim_details', locals: { claim: claim }

        - if claim.transfer?
          = render partial: 'shared/claim_transfer_details', locals: { claim: claim }

        - if claim&.requires_trial_dates?
          = render partial: 'shared/claim_trial_details', locals: { claim: claim }

        - if claim&.requires_retrial_dates?
          = render partial: 'shared/claim_retrial_details', locals: { claim: claim }


    -# = "External user TABLE"
    -# %table.summary{ summary: t('.summary') }
    -#   %caption
    -#     %span.table-caption.visuallyhidden
    -#       = t('.caption')
    -#   %tbody
    -#     - unless claim.providers_ref.blank?
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t('common.external_user.providers_ref')
    -#         %td
    -#           = claim.providers_ref

    -#     - if claim.lgfs?
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t('common.external_user.claim_creator')
    -#         %td
    -#           = claim.creator.name

    -#     - unless claim.draft?
    -#       %tr
    -#         %th{scope: "col"}
    -#           = "Claim submitted on"
    -#         %td
    -#           = claim.submitted_at

    -#     - if claim.agfs?
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("common.external_user.#{claim.external_user_type}")
    -#         %td
    -#           = claim.external_user.name

    -#     %tr
    -#       %th{ class: 'bold' }
    -#         = t("common.crown_court")
    -#       %td
    -#         = claim.court.name if claim.court

    -#     %tr
    -#       %th{ class: 'bold' }
    -#         = t("case_number", scope: claim_fields)
    -#       %td
    -#         = claim.case_number

    -#     - if claim.transfer_court.present?
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("common.transfer_court")
    -#         %td
    -#           = claim.transfer_court.name if claim.transfer_court

    -#     - if claim.transfer_case_number.present?
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("common.transfer_case_number")
    -#         %td
    -#           = claim.transfer_case_number

    -#     - if claim.case_type&.name
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("case_type", scope: claim_fields)
    -#         %td
    -#           = claim.case_type&.name

    -#     - if claim.requires_case_concluded_date?
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t('external_users.claims.case_details.case_concluded_date.case_concluded_at')
    -#         %td
    -#           = claim.case_concluded_at

    -#     - if claim&.case_type && claim.requires_cracked_dates?
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("trial_fixed_notice_at", scope: cracked_trial_fields)
    -#         %td
    -#           = claim&.trial_fixed_notice_at&.strftime(Settings.date_format)
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("trial_fixed_at", scope: cracked_trial_fields)
    -#         %td
    -#           = claim&.trial_fixed_at&.strftime(Settings.date_format)
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("trial_cracked_at", scope: cracked_trial_fields)
    -#         %td
    -#           = claim&.trial_cracked_at&.strftime(Settings.date_format)
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("trial_cracked_at_third", scope: cracked_trial_fields)
    -#         %td
    -#           = claim&.trial_cracked_at_third&.humanize

    -#     - if claim&.requires_trial_dates?
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("first_day_of_trial", scope: trial_detail_fields)
    -#         %td
    -#           = claim&.first_day_of_trial&.strftime(Settings.date_format)
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("estimated_trial_length", scope: trial_detail_fields)
    -#         %td
    -#           = claim&.estimated_trial_length
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("actual_trial_length", scope: trial_detail_fields)
    -#         %td
    -#           = claim&.actual_trial_length
    -#       %tr
    -#         %th{ class: 'bold' }
    -#           = t("trial_concluded_at", scope: trial_detail_fields)
    -#         %td
    -#           = claim&.trial_concluded_at&.strftime(Settings.date_format)

    -#       - if claim&.requires_retrial_dates?
    -#         %tr
    -#           %th{ class: 'bold' }
    -#             = t("retrial_started_at", scope: retrial_detail_fields)
    -#           %td
    -#             = claim&.retrial_started_at&.strftime(Settings.date_format)
    -#         %tr
    -#           %th{ class: 'bold' }
    -#             = t("retrial_estimated_length", scope: retrial_detail_fields)
    -#           %td
    -#             = claim&.retrial_estimated_length
    -#         %tr
    -#           %th{ class: 'bold' }
    -#             = t("retrial_actual_length", scope: retrial_detail_fields)
    -#           %td
    -#             = claim&.retrial_actual_length
    -#         %tr
    -#           %th{ class: 'bold' }
    -#             = t("retrial_concluded_at", scope: retrial_detail_fields)
    -#           %td
    -#             = claim&.retrial_concluded_at&.strftime(Settings.date_format)
    -#         %tr
    -#           %th{ class: 'bold' }
    -#             = t("retrial_reduction", scope: retrial_detail_fields)
    -#           %td
    -#             = claim&.retrial_reduction? ? t('.answer_yes') : t('.answer_no')

  - else
    - if local_assigns.has_key?(:editable) && !local_assigns[:editable]
      = render partial: 'shared/summary/section_status', locals: { claim: claim, section: section, step: :case_details }
    - else
      = t("shared.summary.no_values.case_details")
